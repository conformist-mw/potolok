<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Отрезы!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-theme.min.css') }}">
    <style type="text/css">
      /* Hide HTML5 Up and Down arrows. */
      input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

input[type="number"] {
    -moz-appearance: textfield;
}
.remove-form {
  margin-top: 15px;
}
    </style>
  </head>

  <body>

    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Отрезы</a>
          <a class="navbar-brand" href="/admin">Admin</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="col-md-11">
          <div class="row">
            <div class="col-sm-4">
              <form id="search_form" class="panel panel-default" method="POST" action="/search">
                <div class="panel-body">
                  <p><strong>Поиск</strong></p>
                  <div class="form-group">
                    <div class="col-sm-6">
                      <select name="type" id="search" class="form-control" required>
                        <option selected disabled>Фактура</option>
                        <option value="all" data-type='all'>все</option>
                        <option value="LAK" data-type='LAK'>LAK</option>
                        <option value="SATIN" data-type='SATIN'>SATIN</option>
                        <option value="MAT" data-type='MAT'>MAT</option>
                        <option value="EXCLUSIVE" data-type='EXCLUSIVE'>EXCLUSIVE</option>
                      </select>
                    </div>
                    <div class="col-sm-6">
                      <select name="color" id="search_colors" class="form-control"></select>
                    </div>
                  </div>
                  <div class="form-group ">
                  </div>
                  <p><strong>Размеры</strong></p>
                  <div class="form-group ">
                    <div class="input-group">
                      <span class="input-group-addon">ширина</span>
                      <input autocomplete="off" type="text" value="" name="width" class="form-control js-price-format" placeholder="введите значение">
                      <span class="input-group-addon">см</span>
                    </div>
                  </div>
                  <div class="form-group ">
                    <div class="input-group">
                      <span class="input-group-addon">длина</span>
                      <input autocomplete="off" type="text" value="" name="height" class="form-control js-price-format" placeholder="введите значение">
                      <span class="input-group-addon">см</span>
                    </div>
                  </div>
                  <div class="form-group ">
                    <label><input name="removed" value="True" id="removed" type="checkbox"> Удалённые</label>
                    <p><input name="order_num" id="number" type="text" style="display: none;" placeholder="номер заказа"></p>
                  </div>
                  <button type="submit" class="btn btn-success">Показать</button>
                </div>
              </form>
              <form role="form" class="panel panel-default" method="POST" action="/add">
                <div class="panel-body">
                  <p><strong>Добавить</strong></p>
                  <div class="form-group">
                    <div class="col-sm-6">
                      <select name="type" id="add_segment" class="form-control" required>
                        <option selected disabled>Фактура</option>
                        <option value="LAK" data-type='LAK'>LAK</option>
                        <option value="SATIN" data-type='SATIN'>SATIN</option>
                        <option value="MAT" data-type='MAT'>MAT</option>
                        <option value="EXCLUSIVE" data-type='EXCLUSIVE'>EXCLUSIVE</option>
                      </select>
                    </div>
                    <div class="col-sm-6">
                      <select name="color" id="segment_color" class="form-control"></select>
                    </div>
                  </div>
                  <p><strong>Размеры</strong></p>
                  <div class="form-group ">
                    <div class="input-group">
                      <span class="input-group-addon">ширина</span>
                      <input autocomplete="off" type="number" name="width" class="form-control js-price-format" placeholder="введите значение" required>
                      <span class="input-group-addon">см</span>
                    </div>
                  </div>
                  <div class="form-group ">
                    <div class="input-group">
                      <span class="input-group-addon">длина</span>
                      <input autocomplete="off" type="number" name="height" class="form-control js-price-format" placeholder="введите значение" required>
                      <span class="input-group-addon">см</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="input-group">
                      <select name="rack" class="form-control" required>
                        <option selected disabled>Расположение</option>
                        <option value="Стеллаж 1">Стеллаж 1</option>
                        <option value="Стеллаж 2">Стеллаж 2</option>
                        <option value="Стол">Стол</option>
                      </select>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-success">Добавить</button>
                </div>
              </form>
            </div>
            <div class="col-sm-7">
              <div class="panel panel-default">
                {% for segment in segments.items %}
                  <div class="panel-body parent" data-id="{{ segment.id }}">
                    <div class="row">
                      <div class="col-sm-12">
                        <div>
                          <div class="row">
                            <div class="col-sm-7">
                              <p>Фактура: <strong>{{ segment.type }}</strong>&nbsp;&nbsp;&nbsp;Цвет: <strong>{{ segment.color }}</strong></p>
                              {% if not removed %}
                              <p>Расположение: <strong>{{ segment.rack }}</strong></p>
                              {% endif %}
                            </div>
                            <div class="col-sm-5">
                              <p class="text-right">Площадь: <strong class="label label-default">{{ segment.square }} м²</strong></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-12">
                        <p>
                          <span class="label label-success">ширина: {{ segment.width }} см</span>
                          <span class="label label-primary">длина: {{ segment.height }} см</span>
                        </p>
                      </div>
                      <div class="col-sm-12">
                    </div>
                    <div class="col-sm-6">
                      <p class="text-muted">Добавлено: {{ segment.created.strftime('%d %a %H:%M') }}</p>
                    </div>
                    {% if removed %}
                    <div class="col-sm-6">
                      <p class="text-muted">Удалено: {{ segment.deleted.strftime('%d %a %H:%M') }}</p>
                    </div>
                    <div class="col-sm-6">
                      <p class="text-muted">Номер заказа: <span style="color: red;"><b>{{ segment.order_number }}</b></span></p>
                    </div>
                    {% endif %}
                    {% if not removed %}
                      <div class="col-sm-6 text-right">
                        <button class="btn btn-info remove-toggle">Удалить</button>
                      </div>
                    {% endif %}
                      <div class="col-sm-10 col-sm-offset-1 remove-form" data-toggle="{{ segment.id }}" style="display: none">
                        <div class="panel panel-default">
                         <div class="panel-body">
                          <p>Подтверждение:</p>
                          <div class="form-group">
                            <input autocomplete="off" type="text" class="form-control" data-id="{{ segment.id }}" placeholder="Введите номер заказа" required>
                          </div>
                          <div class="text-right">
                            <button class="btn btn-default btn-danger removeSegment">Удалить</button>
                          </div>
                          </div>
                        </div>
                      </div> 
                    </div>
                  <hr>
                  </div>
                {% endfor %}
                <div class="panel-body">
                  <div class="clearfix">
                    <ul class="pagination pull-right">
                    {% if segments.has_prev %}
                      <li><a href="{{ url_for(request.endpoint, page=segments.prev_num) }}"><span>«</span></a></li>
                    {% else %}
                      <li class="disabled"><span>«</span></li>
                    {% endif %}
                    {% for page in segments.iter_pages() %}
                      {% if page %}
                        {% if page != segments.page %}
                          <li><a href="{{ url_for(request.endpoint, page=page) }}">{{ page }}</a></li>
                        {% else %}
                          <li class="active"><span>{{ page }}</span></li>
                        {% endif %}
                      {% else %}
                        <li><span class="ellipsis">...</span></li>
                      {% endif %}
                    {% endfor %}
                    {% if segments.has_next %}
                      <li><a href="{{ url_for(request.endpoint, page=segments.next_num) }}"><span>»</span></a></li>
                    {% else %}
                      <li class="disabled"><span>»</span></li>
                    {% endif %}
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /.container -->
    <script src="{{ url_for('static', filename='jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='colors.js') }}"></script>
    <script>
      $('#removed').click(function(){
        $('#number')[this.checked ? 'show': 'hide']();
      });
      $("#search").on('change', function(){
        var category = $(this).find(':selected').data('type');
        var options = '<option value="all">все</option>';
        if (category == 'all'){
          for (var key in colors){
            $.each(colors[key], function(i, item){
              options += '<option value="' + item + '">' + item + '</option>';
            })
          }
        }
        else {
          $.each(colors[category], function(i, item){
            options += '<option value="' + item + '">' + item + '</option>';
          })
        };
        $('#search_colors').html(options);
      });
      $('#search_form').submit(function(){
        if ($('#number').val() == ''){
          $('#number').remove();
        }
      });
      $("#add_segment").on('change', function(){
        var category = $(this).find(':selected').data('type');
        options = '';
        $.each(colors[category], function(i, item){
          options += '<option value="' + item + '">' + item + '</option>';
        });
        $('#segment_color').html(options);
      })
      $('.remove-toggle').click(function(){
        var toggle_id = $(this).parents('div.parent').data('id');
        var this_el = $('div[data-toggle="' + toggle_id + '"]');
        $('div.remove-form').not(this_el).each(function(){
          $(this).hide('fast');
        });
        $('div[data-toggle="' + toggle_id + '"]').toggle('slow');
      });
      $('.removeSegment').click(function(){
        var segment_id = $(this).parents('div.parent').data('id');
        var input = $('input[data-id="' + segment_id + '"]').val();
        if (input.length > 2){
          $.ajax({
            url: '/remove',
            data: {'id': segment_id, 'order_num': input},
            type: 'post',
            success: function(result){
              $('div[data-id="' + segment_id + '"]').remove();
            }
          });
        };
      });
    </script>
  </body>
</html>
